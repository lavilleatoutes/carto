<!DOCTYPE html>
<html>

<head> 
	<!-- Configuration générale de la page -->
    <meta charset="utf-8" />
    <title>villeatoutes</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="shortcut icon" type="image/png" href="img/logo.png"/>
	
	<!-- Appel des fichiers de style -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.7.2/leaflet.ie.css" /><![endif]-->
    <link rel="stylesheet" href="src/leaflet-sidebar.css" />
	<link rel="stylesheet" href="style.css" />
</head>

<body> <!-- Contenu de la sidebar -->
    <div id="sidebar" class="sidebar collapsed">
        <!-- Icônes du panneau gauche -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab" id="logo"><i class="fa"><img src="img/logo.png" style="width:30px;padding:5px"  /></i></a></li>
                <li><a href="https://lavilleatous.wordpress.com/" role="tab" target="_blank" title="Site officiel"><i class="fa fa-home"></i></a></li>
				<li><a href="https://upload.wikimedia.org/wikipedia/commons/3/37/Livre_les_plus_belles_plages_du_mexique.jpg" role="tab" target="_blank" title="Télécharger la carte"><i class="fa fa-download"></i></a></li>
            </ul>
        </div>

        <!-- Contenu du panneau gauche -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
               <!-- Titre -->
			   <h1 style="text-transform:uppercase" class="sidebar-header">
                    La ville est à tou.te.s
                    <span class="sidebar-close" id="close"><i class="fa fa-caret-left"></i></span>
               </h1>
				
				<!-- Présentation de la carte - légende - affiché par défaut -->
				<div class="presentation" id="defaut">
					</br>
					<h1>Carte des mobilisations et ressources pour une ville juste et solidaire.</h1>
					<i>Cliquez sur un point de la carte pour afficher les informations / cliquer sur une catégorie en légende pour isoler les points correspondants</i>
					</br>
					<div class="boutons">
					<div class="bouton" id="boutonQuartiers"><img src="img/picto_mob_quartiers.png" style="vertical-align:middle; width:20px;padding:0px 10px;"  />Quartiers populaires et logement</div>
					<div class="bouton" id="boutonEquipements"><img src="img/picto_mob_equip.png" style="vertical-align:middle; width:20px;padding:0px 10px;"  />Équipements publics et services</div>
					<div class="bouton" id="boutonEcologie"><img src="img/picto_mob_ecolo.png" style="vertical-align:middle; width:20px;padding:0px 10px;"  />Espaces naturels et écologie</div>
					<div class="bouton" id="boutonDroits"><img src="img/picto_mob_droits.png" style="vertical-align:middle; width:20px;padding:0px 10px;"  />Droits et égalités</div>
					</div>
					
					
    <h2>Cette carte rend visibles :</h2>

    <p class="lorem">Les mobilisations et initiatives portées par des collectifs d’habitant.e.s et/ou de professionnel.le.s engagé.e.s pour une ville plus juste et solidaire, à travers des actions précises et des enjeux identifiés,</p>
    <p class="lorem">Les acteurs-ressources que l’on peut trouver sur un territoire ou au niveau national, qui ont l’expérience de questions similaires et qui peuvent se mobiliser et apporter leur aide.</p>
    <p class="lorem">Les écoles d’architecture et les établissements universitaires qui proposent des enseignements socialement utiles à celles et ceux qui voudraient que la ville se fasse avec eux.</p>

    <h2>Cette carte doit permettre de partager et de mettre en réseau :</h2>

    <p class="lorem">Des expériences de mobilisations ou d’actions collectives,</p>
	<p class="lorem">Des collectifs ou habitants mobilisés entre eux, directement,</p>
    <p class="lorem">Des acteurs-ressources, universitaires entre autres, pouvant apporter leur appui, leur expertise, afin de favoriser des coopérations sur un territoire ou un thème d’action et pour que les habitant.e.s puissent développer de réelles alternatives face aux décisions qui les concernent.</p>

    <p class="lorem">Cette carte enfin a été initiée et créée par l’association Appuii (appuii.wordpress.com), puis enrichie et étayée par divers collectifs. Elle a été réalisée et est gérée par une petite équipe, qui souhaite s’étoffer et que vous pouvez rejoindre (connaissances d’acteurs d’un territoire, d’une thématique, compétences en développement informatique, etc.). Son amélioration dépend de l’implication de celles et ceux qui l’utiliseront et la partageront, puisque désormais la base de données et le site existent.</p>

				
					<br/>
					<p><i><a href="https://lavilleatous.wordpress.com" style="text-decoration:none;" target="_blank ">Voir le site</a> • <a href="https://lavilleatous.wordpress.com/la-carte-cest-quoi/" style="text-decoration:none;" target="_blank ">La carte, c'est quoi ? </a> • <a href="https://lavilleatous.wordpress.com/cest-qui/" style="text-decoration:none;" target="_blank ">La carte, c'est qui ?</a> • <a href="https://lavilleatous.wordpress.com/comment-ca-marche/" style="text-decoration:none;" target="_blank ">Comment ça marche ? </a> • <a href="https://lavilleatous.wordpress.com/liens-utiles/" style="text-decoration:none;" target="_blank ">Liens utiles</a> • <a href="https://lavilleatous.wordpress.com/contact/" style="text-decoration:none;" target="_blank ">Contact</a> • Dernière mise à jour : 07 juin 2019</i></p>
				
				</div>
				
				<!-- Contenu du panneau au clic sur un point -->
				<div id="popup">
					<h1 id="libgeo"></h1>
					<p class="Nom" id="nom"></p>
					<p class="lorem" id="description"></p>
					<p class="Internet" id="internet"></p>					
					<p class="Adresse" id="adresse"></p>
				</div>
				
            </div>

        </div>
    </div>

	<!-- emplacement de la carte -->
	<div id="mapid" class="sidebar-map"></div>
	
	<!-- appel des bibliothèques de script -->
    <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"></script>
    <script src="https://turbo87.github.io/sidebar-v2/js/leaflet-sidebar.js"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
	
    <script>
		
			
		// Création de la carte
		var map = L.map('mapid', {maxZoom:15, minZoom:6
		})
		.setView([46.5, 2], 6);
		map.zoomControl.setPosition('topright');
		
		//Définition des pictos
		var LeafIcon = L.Icon.extend({});
		var picto1a = new LeafIcon({iconUrl: 'img/picto_mob_quartiers.png', iconSize: [20,20], iconAnchor:[5,5]}),
			picto2a = new LeafIcon({iconUrl: 'img/picto_mob_equip.png', iconSize: [20,20], iconAnchor:[5,5]}),
			picto3a = new LeafIcon({iconUrl: 'img/picto_mob_ecolo.png', iconSize: [20,20], iconAnchor:[5,5]}),
			picto4a = new LeafIcon({iconUrl: 'img/picto_mob_droits.png', iconSize: [20,20], iconAnchor:[5,5]});

		// Choix du fond de carte 
		var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 19,
		attribution: ''
		});
		OpenStreetMap_Mapnik.addTo(map);
		
		//Ajout des données drive
		var publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/1sqywRqQwzpNJV1bEtQIDTB7h2RNAsH6vaPrFcwWrKHc/edit?usp=sharing';
		function init() {
			Tabletop.init({ 
				key: publicSpreadsheetUrl,
				callback: showInfo,
				simpleSheet: true
			})
		};
		
		//Création des couches de points
		var pointsQuartier = new L.featureGroup;
		var pointsEquipement = new L.featureGroup;
		var pointsDroit = new L.featureGroup;
		var pointsEcologie = new L.featureGroup;
		
		function showInfo(data, tabletop) {
			for (var i in data){
				var marker;
				
				if (data[i].categorie == 'quartiers') {
					marker = L.marker([data[i].lat, data[i].lon], {icon : picto1a} );
					marker.on('mouseover', function(e) {e.target.setIcon(picto1a); });
					marker.on('mouseout', function(e) {e.target.setIcon(picto1a); });
					marker.addTo(pointsQuartier);
					};
				if (data[i].categorie == 'équipements') {
					marker = L.marker([data[i].lat, data[i].lon], {icon : picto2a});
					marker.on('mouseover', function(e) {e.target.setIcon(picto2a); });
					marker.on('mouseout', function(e) {e.target.setIcon(picto2a); });
					marker.on('click', function(e) {e.target.off('mouseout'); e.target.setIcon(pictoON); });
					marker.addTo(pointsEquipement);
					};
				if (data[i].categorie == 'droits') {
					marker = L.marker([data[i].lat, data[i].lon], {icon : picto3a});
					marker.on('mouseover', function(e) {e.target.setIcon(picto3a); });
					marker.on('mouseout', function(e) {e.target.setIcon(picto3a); });
					marker.addTo(pointsDroit);
					};
				
				if (data[i].categorie == 'écologie') {
					marker = L.marker([data[i].lat, data[i].lon], {icon : picto4a});
					marker.on('mouseover', function(e) {e.target.setIcon(picto4a); });
					marker.on('mouseout', function(e) {e.target.setIcon(picto4a); });
					marker.addTo(pointsEcologie);
					};
				
				marker.properties = {};
				marker.properties.Nom_Structure = data[i].nom_Structure;
				marker.properties.Territoire = data[i].territoire;
				marker.properties.Description = data[i].description;
				marker.properties.Site_internet = data[i].lien_internet;
				marker.properties.Adresse = data[i].Adresse;
				marker.properties.Contact = data[i].contact;
				marker.properties.Mail = data[i].mail;
				marker.properties.Reseau = data[i].reseaux;
				marker.properties.Type = data[i].categorie;
				marker.bindTooltip(data[i].Nom_Structure, {className: 'Tooltips', closeButton: false, offset: [0,0]});
				marker.on('click', function(e) {popup(e.target); });
				
			}
			
		}

		window.addEventListener('DOMContentLoaded', init)
		
		pointsQuartier.addTo(map);
		pointsDroit.addTo(map);
		pointsEquipement.addTo(map);
		pointsEcologie.addTo(map);
		
		//Action au clic sur un point
		
		function popup(e) {
			
			//ouverture de la sidebar
			if (document.getElementById('sidebar').classList.contains('collapsed')){
				sidebar.open('home');
				}
			
			//Remplissage de la popup
			document.getElementById('popup').style.display = "block";
			document.getElementById('defaut').style.display = "none";
			
			document.getElementById('nom').innerHTML = e.properties.Nom_Structure;
			document.getElementById('description').innerHTML = e.properties.Description;
			document.getElementById('internet').innerHTML = "&rarr;  <a href="+e.properties.Site_internet+" target=_blank >Aller sur le site internet</a>" ;
			document.getElementById('adresse').innerHTML = "Adresse : "+e.properties.Adresse ;
			
		}
		
		//Création de la sidebar
		var sidebar = L.control.sidebar('sidebar').addTo(map);

		//Action au clic sur la carte
		map.on('click', function(e) {   
			if (document.getElementById('sidebar').classList.contains('collapsed')) {
				sidebar.open('home');
			}
			else {
				sidebar.close();
			}
			document.getElementById('popup').style.display = "none";
			document.getElementById('defaut').style.display = "block";

			document.getElementById('boutonQuartiers').setAttribute("class", "bouton");
			document.getElementById('boutonEquipements').setAttribute("class", "bouton");
			document.getElementById('boutonEcologie').setAttribute("class", "bouton");
			document.getElementById('boutonDroits').setAttribute("class", "bouton");
			pointsQuartier.addTo(map);
			pointsDroit.addTo(map);
			pointsEquipement.addTo(map);
			pointsEcologie.addTo(map);
		});
		
		//Action au clic sur le logo
		document.getElementById("logo").addEventListener("click", function(){
		document.getElementById('popup').style.display = "none";
		document.getElementById('defaut').style.display = "block";
		if(map.getZoom() < 8){
		if (document.getElementById('sidebar').classList.contains('collapsed')) {
		sidebar.open('home');}
		}
		});

		//Fonctionnement des boutons en légende
		document.getElementById("boutonQuartiers").addEventListener("click", function(event){
			event.stopPropagation();
			document.getElementById('boutonQuartiers').setAttribute("class", "bouton_on");
			document.getElementById('boutonEquipements').setAttribute("class", "bouton");
			document.getElementById('boutonEcologie').setAttribute("class", "bouton");
			document.getElementById('boutonDroits').setAttribute("class", "bouton");
			if (map.hasLayer(pointsQuartier)) {map.removeLayer(pointsQuartier);};
			if (map.hasLayer(pointsDroit)) {map.removeLayer(pointsDroit);};
			if (map.hasLayer(pointsEquipement)) {map.removeLayer(pointsEquipement); }
			if (map.hasLayer(pointsEcologie)==false) {map.addLayer(pointsEcologie); }
		});	

		document.getElementById("boutonEquipements").addEventListener("click", function(event){
			event.stopPropagation();
			document.getElementById('boutonQuartiers').setAttribute("class", "bouton");
			document.getElementById('boutonEquipements').setAttribute("class", "bouton_on");
			document.getElementById('boutonEcologie').setAttribute("class", "bouton");
			document.getElementById('boutonDroits').setAttribute("class", "bouton");
			if (map.hasLayer(pointsQuartier)) {map.removeLayer(pointsQuartier);};
			if (map.hasLayer(pointsDroit)) {map.removeLayer(pointsDroit);};
			if (map.hasLayer(pointsEquipement)) {map.removeLayer(pointsEquipement); }
			if (map.hasLayer(pointsEcologie)==false) {map.addLayer(pointsEcologie); }
		});	
		
		document.getElementById("boutonEcologie").addEventListener("click", function(event){
			event.stopPropagation();
			document.getElementById('boutonQuartiers').setAttribute("class", "bouton");
			document.getElementById('boutonEquipements').setAttribute("class", "bouton");
			document.getElementById('boutonEcologie').setAttribute("class", "bouton_on");
			document.getElementById('boutonDroits').setAttribute("class", "bouton");
			if (map.hasLayer(pointsQuartier)) {map.removeLayer(pointsQuartier);};
			if (map.hasLayer(pointsDroit)) {map.removeLayer(pointsDroit);};
			if (map.hasLayer(pointsEquipement)) {map.removeLayer(pointsEquipement); }
			if (map.hasLayer(pointsEcologie)==false) {map.addLayer(pointsEcologie); }
		});	
		
		document.getElementById("boutonDroits").addEventListener("click", function(event){
			event.stopPropagation();
			document.getElementById('boutonQuartiers').setAttribute("class", "bouton");
			document.getElementById('boutonEquipements').setAttribute("class", "bouton");
			document.getElementById('boutonEcologie').setAttribute("class", "bouton_on");
			document.getElementById('boutonDroits').setAttribute("class", "bouton");
			if (map.hasLayer(pointsQuartier)) {map.removeLayer(pointsQuartier);};
			if (map.hasLayer(pointsDroit)) {map.removeLayer(pointsDroit);};
			if (map.hasLayer(pointsEquipement)) {map.removeLayer(pointsEquipement); }
			if (map.hasLayer(pointsEcologie)==false) {map.addLayer(pointsEcologie); }
		});	

   </script>
	
</body>



</html>
