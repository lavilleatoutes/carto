<!DOCTYPE html>
<html>

<head> 
	<!-- Configuration générale de la page -->
    <meta charset="utf-8" />
    <title>villeatoutes</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="shortcut icon" type="image/png" href="img/logo.png"/>
	
	<!-- Appel des fichiers de style -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.7.2/leaflet.ie.css" /><![endif]-->
    <link rel="stylesheet" href="src/leaflet-sidebar.css" />
	<link rel="stylesheet" href="style.css" />
</head>

<body> <!-- Contenu de la sidebar -->
    <div id="sidebar" class="sidebar collapsed">
        <!-- Icônes du panneau gauche -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab" id="logo"><i class="fa"><img src="img/logo.png" style="width:30px;padding:5px"  /></i></a></li>
                <li><a href="https://lavilleatous.wordpress.com/" role="tab" target="_blank" title="Site officiel"><i class="fa fa-home"></i></a></li>
				<li><a href="https://upload.wikimedia.org/wikipedia/commons/3/37/Livre_les_plus_belles_plages_du_mexique.jpg" role="tab" target="_blank" title="Télécharger la carte"><i class="fa fa-download"></i></a></li>
            </ul>
        </div>

        <!-- Contenu du panneau gauche -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
               <!-- Titre -->
			   <h1 style="text-transform:uppercase" class="sidebar-header">
                    La ville est à tou.te.s
                    <span class="sidebar-close" id="close"><i class="fa fa-caret-left"></i></span>
               </h1>
				
				<!-- Présentation de la carte - légende - affiché par défaut -->
				<div class="presentation" id="defaut">
					</br>
					<i>Cliquez sur un point de la carte pour afficher les informations / cliquer sur une catégorie en légende pour isoler les points correspondants</i>
					</br>
					<div class="boutons">
					<div class="bouton" id="bouton1"><img src="img/picto_1b.png" style="vertical-align:middle; width:20px;padding:0px 10px;"  />Bottom</div>
					<div class="bouton" id="bouton2"><img src="img/picto_2b.png" style="vertical-align:middle; width:20px;padding:0px 10px;"  />Medium</div>
					<div class="bouton" id="bouton3"><img src="img/picto_3b.png" style="vertical-align:middle; width:20px;padding:0px 10px;"  />Top</div>
					</div>
					<h2>Carte des mobilisations et ressources pour une ville juste et solidaire.</h2>
					<p class="lorem">Elle est une première étape : sa mise en ligne en l’état doit permettre d’en améliorer l’accessibilité et l’ergonomie, d’en préciser les entrées et les hiérarchies. Cette première étape en appelle donc aux retours, remarques et critiques de tou.te.s celles et ceux qui l’utiliseront. Il s’agit de la faire évoluer en la pratiquant.</p>
					<p class="lorem">L’amélioration de cet outil dépendra alors de l’implication de celles et ceux qui l’utiliseront et la partageront, puisque désormais la base de données est initiée et le site existe. La carte a été réalisée et est gérée par une petite équipe, qui souhaite s’étoffer et que vous pouvez rejoindre (connaissances d’acteurs d’un territoire, d’une thématique, compétences en développement informatique, etc.).</p>
					<p class="lorem">Cette carte enfin a été initiée et créée par l’association Appuii (appuii.wordpress.com) et enrichie et étayée par divers collectifs intéressés ou sollicités.</p>
					<h2>3 objectifs visés</h2>
					<p class="lorem">Rendre visibles des initiatives portées par des collectifs d’habitant.e.s et/ou de professionnel.le.s engagé.e.s pour une ville plus juste et solidaire;</p>
					<p class="lorem">Partager, mettre en réseau les expériences, les mobilisations et les ressources afin de favoriser des convergences sur un territoire ou un thème d’action et pour que les habitant.e.s aient une réelle influence sur les décisions qui les concernent;</p>
					<p class="lorem">Etre un outil collectif appropriable, géré à moyens terme par celles et ceux qui se mobilisent.</p>
					<h2>Pour contribuer à cette carte, la rendre active et constituer le réseau de partage des expériences et des ressources :</h2>
					<p class="lorem">ajoutez ou modifiez les informations qui vous concernent dans le formulaire mis à disposition > ICI</p>
					<p class="lorem">laissez des commentaires (en bas de cette page) pour améliorer cet outil en construction,</p>
					<p class="lorem">venez aux permanences de « La ville est à tou.t.e.s, carte des mobilisations et des ressources pour une ville juste et solidaire »(voir ci-dessous)</p>
					<h2>Les prochaines permanences ont lieu tous les 1ers et 3èmes mardis de chaque mois</h2>
					<p class="lorem">pour l’instant à la MSH Paris nord (20 avenue George Sand, 93210 Saint-Denis, PLAN) :</p>
					<p class="lorem">mardi 20 novembre 2018, de 14h à 18h</p>
					<p class="lorem">mardi 4 décembre, de 16h à 20h</p>
					<p class="lorem">mardi 18 décembre, de 16h à 20h</p>
					<p class="lorem">Les permanences proposées se déroulent à la Plaine Saint-Denis (MSH Paris nord) mais elles peuvent évidemment s’organiser ailleurs selon les propositions des participants.</p>
				
					<br/>
					<p><i>Menu : <a href="https://lavilleatous.wordpress.com/la-carte-cest-quoi/" style="text-decoration:none;" target="_blank ">La carte, c'est quoi ? </a> • <a href="https://lavilleatous.wordpress.com/cest-qui/" style="text-decoration:none;" target="_blank ">La carte, c'est qui ?</a> • <a href="https://lavilleatous.wordpress.com/comment-ca-marche/" style="text-decoration:none;" target="_blank ">Comment ça marche ? </a> • <a href="https://lavilleatous.wordpress.com/liens-utiles/" style="text-decoration:none;" target="_blank ">Liens utiles</a> • <a href="https://lavilleatous.wordpress.com/contact/" style="text-decoration:none;" target="_blank ">Contact</a> • Dernière mise à jour : 27 novembre 2018</i></p>
				
				</div>
				
				<!-- Contenu du panneau au clic sur un point -->
				<div id="popup">
					<h1 id="libgeo"></h1>
					<p class="Nom" id="nom"></p>
					<p class="lorem" id="description"></p>
					<p class="Internet" id="internet"></p>					
					<p class="Adresse" id="adresse"></p>
				</div>
				
            </div>

        </div>
    </div>

	<!-- emplacement de la carte -->
	<div id="mapid" class="sidebar-map"></div>
	
	<!-- appel des bibliothèques de script -->
    <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"></script>
    <script src="https://turbo87.github.io/sidebar-v2/js/leaflet-sidebar.js"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
	
    <script>
		
			
		// Création de la carte
		var map = L.map('mapid', {maxZoom:15, minZoom:6
		})
		.setView([46.5, 2], 6);
		map.zoomControl.setPosition('topright');
		
		//Définition des pictos
		var LeafIcon = L.Icon.extend({});
		var picto1a = new LeafIcon({iconUrl: 'img/picto_1a.png', iconSize: [10,10], iconAnchor:[5,5]}),
			picto2a = new LeafIcon({iconUrl: 'img/picto_2a.png', iconSize: [10,10], iconAnchor:[5,5]}),
			picto3a = new LeafIcon({iconUrl: 'img/picto_3a.png', iconSize: [10,10], iconAnchor:[5,5]}),
			picto1b= new LeafIcon({iconUrl: 'img/picto_1b.png', iconSize: [20,20], iconAnchor:[10,10]}),
			picto2b= new LeafIcon({iconUrl: 'img/picto_2b.png', iconSize: [20,20], iconAnchor:[10,10]}),
			picto3b= new LeafIcon({iconUrl: 'img/picto_3b.png', iconSize: [20,20], iconAnchor:[10,10]});
			pictoON= new LeafIcon({iconUrl: 'img/picto_1c.png', iconSize: [30,30], iconAnchor:[15,15]});

		// Choix du fond de carte 
		var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 19,
		attribution: ''
		});
		OpenStreetMap_Mapnik.addTo(map);
		
		//Ajout des données drive
		var publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/1GOzHW2ub-a1yDTWjq0wPUEO_Ojg17GBI3gOXAyourzQ/edit?usp=sharing';
		function init() {
			Tabletop.init({ 
				key: publicSpreadsheetUrl,
				callback: showInfo,
				simpleSheet: true
			})
		};
		
		//Création des couches de points
		var pointBottom = new L.featureGroup;
		var pointMedium = new L.featureGroup;
		var pointTop = new L.featureGroup;
		
		function showInfo(data, tabletop) {
			for (var i in data){
				var marker;
				
				if (data[i].BMT == 'bottom') {
					marker = L.marker([data[i].LAT, data[i].LNG], {icon : picto1a} );
					marker.on('mouseover', function(e) {e.target.setIcon(picto1b); });
					marker.on('mouseout', function(e) {e.target.setIcon(picto1a); });
					marker.addTo(pointBottom);
					};
				if (data[i].BMT == 'medium') {
					marker = L.marker([data[i].LAT, data[i].LNG], {icon : picto2a});
					marker.on('mouseover', function(e) {e.target.setIcon(picto2b); });
					marker.on('mouseout', function(e) {e.target.setIcon(picto2a); });
					//marker.on('click', function(e) {e.target.off('mouseout'); e.target.setIcon(pictoON); });
					marker.addTo(pointMedium);
					};
				if (data[i].BMT == 'top') {
					marker = L.marker([data[i].LAT, data[i].LNG], {icon : picto3a});
					marker.on('mouseover', function(e) {e.target.setIcon(picto3b); });
					marker.on('mouseout', function(e) {e.target.setIcon(picto3a); });
					marker.addTo(pointTop);
					};
				
				marker.properties = {};
				marker.properties.Nom_Structure = data[i].Nom_Structure;
				marker.properties.Description_courte = data[i].Description_courte;
				marker.properties.Site_internet = data[i].Site_internet;
				marker.properties.Adresse = data[i].Adresse;
				marker.properties.Type = data[i].BMT;
				marker.bindTooltip(data[i].Nom_Structure, {className: 'Tooltips', closeButton: false, offset: [0,0]});
				marker.on('click', function(e) {popup(e.target); });
				
			}
			
		}

		window.addEventListener('DOMContentLoaded', init)
		
		pointBottom.addTo(map);
		pointMedium.addTo(map);
		pointTop.addTo(map);
		
		//Action au clic sur un point
		
		function popup(e) {
			
			//ouverture de la sidebar
			if (document.getElementById('sidebar').classList.contains('collapsed')){
				sidebar.open('home');
				}
			
			//Remplissage de la popup
			document.getElementById('popup').style.display = "block";
			document.getElementById('defaut').style.display = "none";
			
			document.getElementById('nom').innerHTML = e.properties.Nom_Structure;
			document.getElementById('description').innerHTML = e.properties.Description_courte;
			document.getElementById('internet').innerHTML = "&rarr;  <a href="+e.properties.Site_internet+" target=_blank >Aller sur le site internet</a>" ;
			document.getElementById('adresse').innerHTML = "Adresse : "+e.properties.Adresse ;
		}
		
		//Création de la sidebar
		var sidebar = L.control.sidebar('sidebar').addTo(map);

		//Action au clic sur la carte
		map.on('click', function(e) {   
			if (document.getElementById('sidebar').classList.contains('collapsed')) {
				sidebar.open('home');
			}
			else {
				sidebar.close();
			}
			document.getElementById('popup').style.display = "none";
			document.getElementById('defaut').style.display = "block";

			document.getElementById('bouton1').setAttribute("class", "bouton");
			document.getElementById('bouton2').setAttribute("class", "bouton");
			document.getElementById('bouton3').setAttribute("class", "bouton");
			map.addLayer(pointBottom);
			map.addLayer(pointMedium);
			map.addLayer(pointTop);
		});
		
		//Action au clic sur le logo
		document.getElementById("logo").addEventListener("click", function(){
		document.getElementById('popup').style.display = "none";
		document.getElementById('defaut').style.display = "block";
		if(map.getZoom() < 8){
		if (document.getElementById('sidebar').classList.contains('collapsed')) {
		sidebar.open('home');}
		}
		});

		//Fonctionnement des boutons en légende
		document.getElementById("bouton1").addEventListener("click", function(event){
			event.stopPropagation();
			document.getElementById('bouton1').setAttribute("class", "bouton_on");
			document.getElementById('bouton2').setAttribute("class", "bouton");
			document.getElementById('bouton3').setAttribute("class", "bouton");
			if (map.hasLayer(pointMedium)) {map.removeLayer(pointMedium);};
			if (map.hasLayer(pointTop)) {map.removeLayer(pointTop);};
			if (map.hasLayer(pointBottom)==false) {map.addLayer(pointBottom); }
		});	

		document.getElementById("bouton2").addEventListener("click", function(event){
			event.stopPropagation();
			document.getElementById('bouton1').setAttribute("class", "bouton");
			document.getElementById('bouton2').setAttribute("class", "bouton_on");
			document.getElementById('bouton3').setAttribute("class", "bouton");
			if (map.hasLayer(pointBottom)) {map.removeLayer(pointBottom);};
			if (map.hasLayer(pointTop)) {map.removeLayer(pointTop);};
			if (map.hasLayer(pointMedium)==false) {map.addLayer(pointMedium); }
		});	
		
		document.getElementById("bouton3").addEventListener("click", function(event){
			event.stopPropagation();
			document.getElementById('bouton1').setAttribute("class", "bouton");
			document.getElementById('bouton2').setAttribute("class", "bouton");
			document.getElementById('bouton3').setAttribute("class", "bouton_on");
			if (map.hasLayer(pointMedium)) {map.removeLayer(pointMedium);};
			if (map.hasLayer(pointBottom)) {map.removeLayer(pointBottom);};
			if (map.hasLayer(pointTop)==false) {map.addLayer(pointTop); }
		});	

   </script>
	
</body>



</html>
